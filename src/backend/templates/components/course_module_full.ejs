<link href="https://unpkg.com/dropzone@5/dist/min/dropzone.min.css" rel="stylesheet" />
<div class="p-5 rounded-md w-full md:w-1/2 text-black dark:text-white">
    <h1 class="text-xl font-semibold pb-5">
        <%= courseModule.title %>
    </h1>
    <div class="course-module-description mb-3">
        <%- courseModule.description %>
    </div>
    <% if(Object.keys(courseModule.files).length > 0) { %>
        <div class="pt-2">
            Attached files:
            <ul class="list-inside list-none">
                <% courseModule.files.forEach(function(file) { %>
                <li>
                    <a href="/course/<%= courseId %>/<%= courseTabId %>/<%= courseModuleId %>/<%= file.id %>" download class="text-blue-400 hover:text-blue-200">
                        <ion-icon name="document-outline"></ion-icon>
                        <%= file.file_name %> (<%= file.file_size %> bytes)
                    </a>
                </li>
                <% }); %>
            </ul>
        </div>
    <% } %>
</div>

<!-- File selection input -->
<% if (role === "student") { %>
    <div class="dropzone-container container mx-auto my-10">
        <form action="/upload/submission" class="dropzone" id="myDropzone">
            <div class="fallback">
                <input name="file" type="file" multiple />
                <button>Detach</button>
            </div>
            <div class="dz-message">
                Drop files here or click to upload.
            </div>
        </form>
        <button id="submit-assignment" class="btn">Submit Assignment</button>
    </div>
<% } %>

<!-- Right column for Grading Information -->
<% if(courseModule.assignment !== undefined) { %>
    <div class="card bg-gray-200 text-black dark:text-white dark:bg-gray-700 w-full md:w-96 shadow-2xl ml-4 rounded-md">
        <div class="card-body">
            <h2 class="card-title text-center">Grading</h2>
            <div class="divider"></div>
            <div class="flex items-center gap-2">
                <ion-icon name="calendar-number-outline" style="font-size: 64px"></ion-icon>
                <span>Due Date: <%= courseModule.assignment.due_date %></span>
            </div>
            <div class="divider"></div>
            <div class="flex items-center gap-2">
                <ion-icon name="document-outline" style="font-size: 40px"></ion-icon>
                <span>Type: Assignment</span>
            </div>
            <div class="divider"></div> <!-- DaisyUI divider -->
            <div class="card-actions justify-center">
                <div class="badge badge-info badge-lg">
                    <%= courseModule.assignment.total_points %> points
                </div>
            </div>
        </div>
    </div>
<% } %>
</div>

<script src="https://unpkg.com/dropzone@5/dist/min/dropzone.min.js"></script>

<script>
    // Initialize Dropzone on the form element
    document.addEventListener("DOMContentLoaded", function() {
        const dropzoneElement = document.querySelector("#myDropzone");
        if (dropzoneElement) {
            const myDropzone = new Dropzone(dropzoneElement, {
                paramName: "file",
                maxFilesize: 20,
                addRemoveLinks: true,
                uploadMultiple: true,
                parallelUploads: 100,
                maxFiles: 100,
                autoProcessQueue: false
            });

            dropzoneElement.addEventListener("submit", function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (myDropzone.files.length) {
                    myDropzone.processQueue(); // Process all queued files
                } else {
                    alert("Please select files to upload.");
                }
            });
        } else {
            console.error("Dropzone element not found");
        }
    });


    document.querySelector("#myDropzone").addEventListener("submit", function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (myDropzone.files.length) {
            myDropzone.processQueue(); // Process all queued files
        } else {
            alert("Please select files to upload.");
        }
    });
</script>

<style>
    .dropzone-container {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .dropzone {
        background: #2d3748;
        border: 2px dashed #4a5568;
        width: 100%;
    }

    .dropzone .dz-message {
        color: white;
    }

    #submit-assignment {
        margin-top: 10px;
    }
</style>